<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Forced Alignment Comparison • nzilbb.labbcat</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../../bootstrap-toc.css">
<script src="../../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../../pkgdown.css" rel="stylesheet">
<script src="../../pkgdown.js"></script><meta property="og:title" content="Forced Alignment Comparison">
<meta property="og:description" content="nzilbb.labbcat">
<meta property="og:image" content="/logo.png">
<meta name="twitter:card" content="summary">
<meta name="twitter:creator" content="@labbcat">
<meta name="twitter:site" content="@labbcat">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../../index.html">nzilbb.labbcat</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.1-1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../../articles/examples/forced-alignment-comparison.html">Forced Alignment Comparison</a>
    </li>
    <li>
      <a href="../../articles/examples/search-labels-alignments-praat-script.html">Search, Annotation, and Praat Script Example</a>
    </li>
    <li>
      <a href="../../articles/examples/search-labels-alignments-r-script.html">Search, Annotation, and R Script Example</a>
    </li>
  </ul>
</li>
<li>
  <a href="../../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Forced Alignment Comparison</h1>
                        <h4 data-toc-skip class="author">Robert Fromont</h4>
            
            <h4 data-toc-skip class="date">13/04/2022</h4>
      
      
      <div class="hidden name"><code>forced-alignment-comparison.Rmd</code></div>

    </div>

    
    
<p>LaBB-CAT integrates with several forced-aligners, which automatically determine the start and end time of each word, and each segment within each word, given each utterance transcript and start/edn time, and the wav corresponding file.</p>
<p>LaBB-CAT can also compare alignments using a module that maps annotations on one layer to those on another, and computes the overlap rate of the annotation pairs; i.e. a measure of how much the alignments agree with each other.</p>
<p>This example shows how, given a set of manual word/segment alignments (in this case, New Zealand English utterances), it’s possible to run several different forced alignment configurations, and compare them with the manual alignments, in order to determine which forced alignment configuration works best for the type of speech data being processed.</p>
<div class="section level2">
<h2 id="set-up-initial-environment">Set Up Initial Environment<a class="anchor" aria-label="anchor" href="#set-up-initial-environment"></a>
</h2>
<p>Almost all the operations needed for forced alignment comparison can be implemented directly in code. However, the annotator modules used must be already installed in LaBB-CAT. In this case, there is a local LaBB-CAT instance that already has the following annotator modules installed:</p>
<ul>
<li>
<em>CMU Dictionary Manager</em>, which provides ARPAbet-encoded pronunciations for words</li>
<li>
<em>HTK Layer Manager</em>, which will perform forced alignment using the above dictionary and the ‘P2FA’ pre-trained models.</li>
<li>
<em>MFA Manager</em>, which integrates with the Montreal Forced Aligner</li>
<li>
<em>BAS Web Services Annotator</em>, which provides access to the ‘WebMAUS’ web service for forced alignment.</li>
</ul>
<p>Defining the location of the LaBB-CAT server, and the transcript/media files is also required:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://nzilbb.github.io/labbcat-R/" class="external-link">nzilbb.labbcat</a></span><span class="op">)</span>
<span class="va">dataDir</span> <span class="op">&lt;-</span> <span class="st">"data"</span>
<span class="va">transcriptFiles</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">dir</a></span><span class="op">(</span>path <span class="op">=</span> <span class="va">dataDir</span>, pattern <span class="op">=</span> <span class="st">".*\\.TextGrid$"</span>, full.names <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>
<span class="va">url</span> <span class="op">&lt;-</span> <span class="st">"http://localhost:8080/labbcat/"</span></code></pre></div>
</div>
<div class="section level2">
<h2 id="cleaning-up-any-previous-setup">Cleaning up any previous setup<a class="anchor" aria-label="anchor" href="#cleaning-up-any-previous-setup"></a>
</h2>
<p>This process is designed to be re-runnable, so we don’t assume that the LaBB-CAT instance is completely empty. The following code removes any previously-created configuration and data.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># delete layers</span>
<span class="fu"><a href="../../reference/deleteLayer.html">deleteLayer</a></span><span class="op">(</span><span class="va">url</span>, <span class="st">"cmuDictPhonemes"</span><span class="op">)</span>
<span class="fu"><a href="../../reference/deleteLayer.html">deleteLayer</a></span><span class="op">(</span><span class="va">url</span>, <span class="st">"p2fa"</span><span class="op">)</span>
<span class="fu"><a href="../../reference/deleteLayer.html">deleteLayer</a></span><span class="op">(</span><span class="va">url</span>, <span class="st">"p2faPhone"</span><span class="op">)</span>
<span class="fu"><a href="../../reference/deleteLayer.html">deleteLayer</a></span><span class="op">(</span><span class="va">url</span>, <span class="st">"p2faComp"</span><span class="op">)</span>
<span class="fu"><a href="../../reference/deleteLayer.html">deleteLayer</a></span><span class="op">(</span><span class="va">url</span>, <span class="st">"mfaGAm"</span><span class="op">)</span>
<span class="fu"><a href="../../reference/deleteLayer.html">deleteLayer</a></span><span class="op">(</span><span class="va">url</span>, <span class="st">"mfaGAmPhone"</span><span class="op">)</span>
<span class="fu"><a href="../../reference/deleteLayer.html">deleteLayer</a></span><span class="op">(</span><span class="va">url</span>, <span class="st">"mfaGAmComp"</span><span class="op">)</span>
<span class="fu"><a href="../../reference/deleteLayer.html">deleteLayer</a></span><span class="op">(</span><span class="va">url</span>, <span class="st">"mfaUKE"</span><span class="op">)</span>
<span class="fu"><a href="../../reference/deleteLayer.html">deleteLayer</a></span><span class="op">(</span><span class="va">url</span>, <span class="st">"mfaUKEPhone"</span><span class="op">)</span>
<span class="fu"><a href="../../reference/deleteLayer.html">deleteLayer</a></span><span class="op">(</span><span class="va">url</span>, <span class="st">"mfaUKEComp"</span><span class="op">)</span>
<span class="fu"><a href="../../reference/deleteLayer.html">deleteLayer</a></span><span class="op">(</span><span class="va">url</span>, <span class="st">"maus"</span><span class="op">)</span>
<span class="fu"><a href="../../reference/deleteLayer.html">deleteLayer</a></span><span class="op">(</span><span class="va">url</span>, <span class="st">"mausPhone"</span><span class="op">)</span>
<span class="fu"><a href="../../reference/deleteLayer.html">deleteLayer</a></span><span class="op">(</span><span class="va">url</span>, <span class="st">"mausComp"</span><span class="op">)</span>

<span class="co"># delete any pre-existing transcripts</span>
<span class="kw">for</span> <span class="op">(</span><span class="va">transcriptName</span> <span class="kw">in</span> <span class="va">transcriptFiles</span><span class="op">)</span> <span class="op">{</span>
  <span class="co"># if the transcript is in LaBB-CAT...</span>
  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="fu"><a href="../../reference/getMatchingTranscriptIds.html">getMatchingTranscriptIds</a></span><span class="op">(</span><span class="va">url</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"id = '"</span>, <span class="va">transcriptName</span>, <span class="st">"'"</span>, sep<span class="op">=</span><span class="st">""</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span> <span class="op">{</span>
    <span class="co"># ...delete it </span>
    <span class="fu"><a href="../../reference/deleteTranscript.html">deleteTranscript</a></span><span class="op">(</span><span class="va">url</span>, <span class="va">transcriptName</span><span class="op">)</span>
  <span class="op">}</span>
<span class="op">}</span> <span class="co"># next textGrid</span></code></pre></div>
</div>
<div class="section level2">
<h2 id="forced-alignment">Forced alignment<a class="anchor" aria-label="anchor" href="#forced-alignment"></a>
</h2>
<p>There are several configurations for forced alignment compared here, including different forced aligners, and different configurations of the same forced aligner.</p>
<p>These can be compared to the manual alignments by mapping manually aligned words to automatically aligned words, and then within each word token, mapping the manually aligned phones to the automatically aligned phones.</p>
<p>This is performed using the Layer Mapper module, which is configured to map and compare each of the forced alignment configurations.</p>
<div class="section level3">
<h3 id="htk">HTK<a class="anchor" aria-label="anchor" href="#htk"></a>
</h3>
<p>The Hidden Markov Model Toolkit (HTK) is a speech recognition toolkit developed at Cambridge University. Integration with LaBB-CAT involves specifying the layer where the orthographic transcription comes from, and another that provides phonemic transcriptions for each word token, in adding to setting up layers for receiving word and phoneme alignments.</p>
<div class="section level4">
<h4 id="cmu-pronouncing-dictionary">CMU Pronouncing Dictionary<a class="anchor" aria-label="anchor" href="#cmu-pronouncing-dictionary"></a>
</h4>
<p>We will use the <a href="http://www.speech.cs.cmu.edu/cgi-bin/cmudict" class="external-link">CMU Pronouncing Dictionary</a>, to provide word pronunciations for our corpus, using a LaBB-CAT module that integrates with the CMU Pronouncing dictionary:</p>
<details><summary><code>getAnnotatorDescriptor(url, "CMUDictionaryTagger")$taskParameterInfo</code></summary><h3>CMU Pronouncing Dictionary</h3>

<p> This annotator tags words with their pronunciations according to the
  <a href="http://www.speech.cs.cmu.edu/cgi-bin/cmudict" class="external-link">CMU Pronouncing dictionary</a>,
  a machine-readable pronunciation dictionary for North American English that contains
  over 125,000 words and their transcriptions. </p> 

<p> Configuration parameters are encoded as a URL query string, e.g. <br><samp>tokenLayerId=orthography&amp;pronunciationLayerId=phonemes&amp;encoding=DISC</samp></p>

<p> Parameters are: </p>
<dl>
<dt> tokenLayerId </dt> <dd> Input layer from which words come. </dd>
  <dt> transcriptLanguageLayerId </dt> <dd> Transcript attribute for overall language, so the
    annotator can avoid tagging non-English transcripts.</dd>
  <dt> phraseLanguageLayerId </dt> <dd> Layer for annotating phrases in a different
    language, so the annotator can avoid tagging non-English phrases. </dd> 
  <dt> pronunciationLayerId </dt> <dd> Output layer to which pronunciations are added. </dd>
  <dt> encoding </dt> <dd> Which encoding system should be used for the resulting annotation
    labels. Possible values are: <ul>
<li>"CMU" - CMU ARPAbet encoding, e.g. "T R AE2 N S K R IH1 P SH AH0 N"</li>
      <li>"DISC" - CELEX DISC encoding, e.g. "tr{nskrIpS@n"</li>
</ul>
</dd> 
  <dt> firstVariantOnly </dt> <dd> If there are multiple entries for the token, use
    only the first one. Value should be "on" for <tt>true</tt>, and the parameter
    should be absent to indicate <tt>false</tt>. </dd> 
</dl></details><hr>
<p>The <em>cmuDictPhonemes</em> layer is configured as follows:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">cmuDictPhonemes</span> <span class="op">=</span> <span class="fu"><a href="../../reference/newLayer.html">newLayer</a></span><span class="op">(</span>
  <span class="va">url</span>, <span class="st">"cmuDictPhonemes"</span>, 
  description <span class="op">=</span> <span class="st">"Phonemic transcriptions according to the CMU Pronouncing Dictionary"</span>,
  alignment <span class="op">=</span> <span class="fl">0</span>, parent.id <span class="op">=</span> <span class="st">"word"</span>, 
  annotator.id <span class="op">=</span> <span class="st">"CMUdict"</span>, 
  annotator.task.parameters <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span>
    <span class="st">"tokenLayerId=orthography"</span>,   <span class="co"># get word tokens from orthography layer</span>
    <span class="st">"pronunciationLayerId=cmuDictPhonemes"</span>,
    <span class="st">"encoding=CMU"</span>,               <span class="co"># Use original ARPAbet encoding, not CELEX DISC encoding</span>
    <span class="st">"transcriptLanguageLayerId="</span>, <span class="co"># not filtering tagging by language...</span>
    <span class="st">"phraseLanguageLayerId="</span>,
    sep <span class="op">=</span> <span class="st">"&amp;"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
</div>
<div class="section level4">
<h4 id="p2fa-forced-alignment">P2FA forced alignment<a class="anchor" aria-label="anchor" href="#p2fa-forced-alignment"></a>
</h4>
<p>The LaBB-CAT module that integrates with HTK can be configured in various ways, for example to train acoustic models from scratch on the corpus data itself, or to use pre-trained models from another corpus.</p>
<p>The module includes pre-trained acoustic models from the <a href="https://babel.ling.upenn.edu/phonetics/old_website_2015/p2fa/index.html" class="external-link">University of Pennsylvania Phonetics Lab Forced Aligner (P2FA)</a>. The P2FA models were trained on 25.5 hours of speech by adult American English speakers, specifically speech of eight Supreme Court Justices selected from oral arguments in the Supreme Court of the United States (SCOTUS) corpus.</p>
<p>The LaBB-CAT module that integrates with HTK is called <em>HTKAligner</em>:</p>
<details><summary><code>getAnnotatorDescriptor(url, "HTKAligner")$taskParameterInfo</code></summary><h3>HTK Aligner</h3>

<p> The HTK Aligner can use words with phonemic transcriptions, and the
  corresponding audio, to force-align words and phones; i.e. determine the start and
  end time of each speech sound within each word, and thus the start/end times of the
  words. </p>

<p> Configuration parameters are encoded as a URL query string, e.g. <br><samp>orthographyLayerId=orthography&amp;pauseMarkers=-&amp;pronunciationLayerId=cmudict&amp;noiseLayerId=noise&amp;mainUtteranceGrouping=Speaker&amp;otherUtteranceGrouping=Not Aligned&amp;noisePatterns=laugh.* unclear .*noise.*&amp;overlapThreshold=5&amp;wordAlignmentLayerId=word&amp;phoneAlignmentLayerId=segmentutteranceTagLayerId=htk&amp;cleanupOption=100</samp>
  <br><em>NB</em> Ensure the configuration string provided has all parts correctly
  URI-encoded; in particular, the space delimiter of <tt>noisePatterns</tt> should be
  encoded <tt>%20</tt> or <tt>+</tt> </p>

<p> Parameters are: </p>
<dl>
<dt> orthographyLayerId </dt> <dd> Input layer from which words come. </dd>
  <dt> pauseMarkers </dt> <dd> Characters that mark pauses in speech in the
    transcript, separated by spaces. </dd>
  <dt> pronunciationLayerId </dt> <dd> Input layer from which word pronunciations come. </dd>
  <dt> mainUtteranceGrouping </dt> <dd> How to group main-participant utterances for
    automatic training. Possible values are : <ul>
<li>"Speaker" - group all main-participant utterances from the same speaker
        together, across all their transcripts. </li>
      <li>"Transcript" - group all main-participant utterances from the same speaker
        together, but only within the same transcript.</li> </ul>
</dd>
  <dt> otherUtteranceGrouping </dt> <dd> How to group non-main-participant utterances
    for automatic training. Possible values are: <ul>
<li>"Not Aligned" - do not include non-main participant speech. </li>
      <li>"Transcript" - group all non-main-participant utterances from the same
        speaker together, but only within the same transcript.</li> </ul>
</dd>
  <dt> pauseMarkers </dt> <dd> Characters that mark pauses in speech in the
    transcript, separated by spaces, e.g. <q>- .</q> </dd>
  <dt> noiseLayerId </dt> <dd> Layer that has noise annotations. </dd>
  <dt> noisePatterns </dt> <dd> Space-delimited list of regular expressions for
    matching on the noise layer, that HTK should model for. e.g.
    "laugh.* unclear .*noise.*" will train three non-speech models for all noise
    annotations whose label starts with the word "laugh", or the label is "unclear", or the
    label includes the word "noise". </dd>
  <dt> overlapThreshold </dt> <dd> Percentage of overlap with other speech, above
    which the utterance is ignored. 0 or blank means no utterances are ignored, no
    matter how much they overlap with other speech. </dd>
  <dt> useP2FA </dt> <dd> Whether to use pre-trained P2FA models or not. </dd>
  <dt> sampleRate </dt> <dd> (optional) "11025" to downsample audio to 11,025Hz before
    alignment. </dd>
  <dt> leftPattern </dt> <dd> Regular expression for matching the ID of the
    participant in the left audio channel. </dd>
  <dt> rightPattern </dt> <dd> Regular expression for matching the ID of the
    participant in the right audio channel. </dd>
  <dt> ignoreAlignmentStatuses </dt> <dd> Set any non-empty value of this parameter to
    overwrite manual alignments, otherwise omit this parameter.  </dd>
  <dt> wordAlignmentLayerId </dt> <dd> Output layer on which word alignments are
    saved. This can be <tt>word</tt> to update main word token alignments, or a
    phrase layer to save alignments separately from main word token alignments. If
    the specified layer doesn't exist, a phrase layer will be created. </dd>
  <dt> phoneAlignmentLayerId </dt> <dd> Output layer on which phone alignments are
    saved. This can be <tt>segment</tt> to update main phone segment alignments, or a
    phrase layer to save alignments separately from main phone segment alignments. If
    the specified layer doesn't exist, a phrase layer will be created. </dd>
  <dt> utteranceTagLayerId </dt> <dd> Optional output layer for a time stamp tagging
    each aligned utterance. If the specified layer doesn't exist, a phrase layer will
    be created. </dd>
  <dt> scoreLayerId </dt> <dd> Output layer on which phone acoustic scores are saved. </dd>
  <dt> cleanupOption </dt> <dd> What should happen with working files after
    training/alignment is finished. Possible values are: <ul>
<li>
<q>75</q> - Working files should be deleted if alignment succeeds.</li>
      <li>
<q>25</q> - Working files should be deleted if alignment fails.</li>
      <li>
<q>100</q> - Working files should be deleted whether alignment succeeds or not.</li>
      <li>
<q>0</q> - Working files should <b>not</b> be deleted whether alignment
        succeeds or not.</li> </ul>
</dd>
</dl></details><hr>
<p>The configuration for using the P2FA pre-trained models is:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">p2fa</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/newLayer.html">newLayer</a></span><span class="op">(</span>
  <span class="va">url</span>, <span class="st">"p2fa"</span>, 
  description <span class="op">=</span> <span class="st">"Word alignments from HTK using the P2FA pretrained acoustic models."</span>,
  alignment <span class="op">=</span> <span class="fl">2</span>, parent.id <span class="op">=</span> <span class="st">"turn"</span>, <span class="co"># a phrase layer</span>
  annotator.id <span class="op">=</span> <span class="st">"HTK"</span>, 
  annotator.task.parameters <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span>
    <span class="st">"orthographyLayerId=orthography"</span>,
    <span class="st">"pronunciationLayerId=cmuDictPhonemes"</span>, <span class="co"># pronunciations come from the CMU Dict layer</span>
    <span class="st">"useP2FA=on"</span>,                           <span class="co"># use pre-trained P2FA models</span>
    <span class="st">"overlapThreshold=5"</span>,                   <span class="co"># ignore utterances that overlap more than 5%</span>
    <span class="st">"wordAlignmentLayerId=p2fa"</span>,     <span class="co"># save word alignments to this layer</span>
    <span class="st">"phoneAlignmentLayerId=p2faPhone"</span>, <span class="co"># this layer will be created by the annotator</span>
    <span class="st">"cleanupOption=100"</span>, sep<span class="op">=</span><span class="st">"&amp;"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
</div>
</div>
<div class="section level3">
<h3 id="montreal-forced-aligner">Montreal Forced Aligner<a class="anchor" aria-label="anchor" href="#montreal-forced-aligner"></a>
</h3>
<p>The <a href="https://montrealcorpustools.github.io/Montreal-Forced-Aligner/" class="external-link">Montreal Forced Aligner (MFA)</a>, is another forced alignment system that uses the <a href="http://kaldi-asr.org/" class="external-link">Kaldi ASR toolkit</a> instead of HTK.</p>
<p>The LaBB-CAT module that integrates with the Montreal Forced Aligner is called <em>MFA</em>:</p>
<details><summary><code>getAnnotatorDescriptor(url, "MFA")$taskParameterInfo</code></summary><h3>MFA</h3>

<p> The MFA Annotator integrates with the
  <a href="https://montrealcorpustools.github.io/Montreal-Forced-Aligner/" class="external-link">
    Montreal Forced Aligner</a>, which can use words with phonemic transcriptions, and
  the corresponding audio, to force-align words and phones; i.e. determine the start
  and end time of each speech sound within each word, and thus the start/end times
  of the words. </p>

<p> Configuration parameters are encoded as a URL query string, e.g. <br><samp>orthographyLayerId=orthography&amp;dictionaryName=english&amp;modelsName=english&amp;wordAlignmentLayerId=word&amp;phoneAlignmentLayerId=segment&amp;utteranceTagLayerId=mfa</samp> </p>

<p> Parameters are: </p> <dl>
<dt> orthographyLayerId </dt> <dd> Input layer from which words come. </dd>
  <dt> pronunciationLayerId </dt> <dd> Input layer from which word pronunciations
    come. If you don't select this layer, you must specify a value for <tt>dictionaryName</tt>. </dd>
  <dt> multilingualIPA </dt> <dd> Set any non-empty value for this parameter to use
    the <tt>--multilingual</tt>_ipa switch, omit the parameter otherwise</dd> 
  <dt> dictionaryName </dt> <dd> If you wish to use one of the available language
    dictionaries instead of specifying a Pronunciation Layer, specify the name with
    this parameter. Available dictionaries are listed at
    <a href="https://github.com/MontrealCorpusTools/mfa-models/tree/main/dictionary" target="mfa" class="external-link">https://github.com/MontrealCorpusTools/mfa-models/tree/main/dictionary</a>
</dd>
  <dt> modelsName </dt> <dd> If you wish to use pre-trained acoustic models instead of
    training models from your speech data, specify the name with this
    parameter. If not specified, acoustic models will be trained from the speech itself.
    Available models are listed at 
    <a href="https://github.com/MontrealCorpusTools/mfa-models/tree/main/acoustic" target="mfa" class="external-link">https://github.com/MontrealCorpusTools/mfa-models/tree/main/acoustic</a>
  </dd>
  <dt> beam </dt> <dd> This is the value for the <tt>--beam</tt> mfa parameter.</dd>  
  <dt> retryBeam </dt> <dd> This is the value for the <tt>--retry-beam</tt> mfa parameter.</dd>   
  <dt> ignoreAlignmentStatuses </dt> <dd> Set any non-empty value of this parameter to
    overwrite manual alignments, otherwise omit this parameter.  </dd>
  <dt> wordAlignmentLayerId </dt> <dd> Output layer on which word alignments are
    saved. This can be <tt>word</tt> to update main word token alignments, or a
    phrase layer to save alignments separately from main word token alignments. If
    the specified layer doesn't exist, a phrase layer will be created. </dd>
  <dt> phoneAlignmentLayerId </dt> <dd> Output layer on which phone alignments are
    saved. This can be <tt>segment</tt> to update main phone segment alignments, or a
    phrase layer to save alignments separately from main phone segment alignments. If
    the specified layer doesn't exist, a phrase layer will be created. </dd>
  <dt> utteranceTagLayerId </dt> <dd> Optional output layer for a time stamp tagging
    each aligned utterance. If the specified layer doesn't exist, a phrase layer will
    be created. </dd>      
</dl></details><hr>
<div class="section level4">
<h4 id="mfa-alignment-with-general-american-english-arpabet-models">MFA Alignment with General American English ARPAbet Models<a class="anchor" aria-label="anchor" href="#mfa-alignment-with-general-american-english-arpabet-models"></a>
</h4>
<p>MFA provides a set <a href="https://mfa-models.readthedocs.io/en/latest/acoustic/English/English%20%28US%29%20ARPA%20acoustic%20model%20v2_0_0.html#English%20(US)%20ARPA%20acoustic%20model%20v2_0_0" class="external-link">pre-trained English models</a> trained on 982 hours of speech by 2484 American English speakers from the LibriSpeech corpus, (Vassil Panayotov and Guoguo Chen and Daniel Povey and Sanjeev Khudanpur (2015) “Librispeech: An ASR corpus based on public domain audio books”, 2015 IEEE International Conference on Acoustics, Speech and Signal Processing (ICASSP), pp 5206-5210, <a href="DOI:10.1109/ICASSP.2015.7178964" class="uri">DOI:10.1109/ICASSP.2015.7178964</a>) and pronunciations from an <a href="https://mfa-models.readthedocs.io/en/latest/dictionary/English/English%20%28US%29%20ARPA%20dictionary%20v2_0_0.html#English%20(US)%20ARPA%20dictionary%20v2_0_0" class="external-link">ARPAbet encoded General American English dictionary</a>.</p>
<p>A layer is set up to use this configuration:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">mfaGAm</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/newLayer.html">newLayer</a></span><span class="op">(</span>
  <span class="va">url</span>, <span class="st">"mfaGAm"</span>, 
  description <span class="op">=</span> <span class="st">"Word alignments from MFA using an ARPAbet dictionary and pretrained models."</span>,
  alignment <span class="op">=</span> <span class="fl">2</span>, parent.id <span class="op">=</span> <span class="st">"turn"</span>, <span class="co"># a phrase layer</span>
  annotator.id <span class="op">=</span> <span class="st">"MFA"</span>, 
  annotator.task.parameters <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span>
    <span class="st">"orthographyLayerId=orthography"</span>,
    <span class="st">"dictionaryName=english_us_arpa"</span>,
    <span class="st">"modelsName=english_us_arpa"</span>,
    <span class="st">"wordAlignmentLayerId=mfaGAm"</span>,       <span class="co"># save word alignments to this layer</span>
    <span class="st">"phoneAlignmentLayerId=mfaGAmPhone"</span>, <span class="co"># this will be created by the annotator</span>
    sep<span class="op">=</span><span class="st">"&amp;"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
</div>
<div class="section level4">
<h4 id="mfa-alignment-with-ipa-models-and-a-non-rhotic-dictionary">MFA Alignment with IPA Models and a Non-rhotic Dictionary<a class="anchor" aria-label="anchor" href="#mfa-alignment-with-ipa-models-and-a-non-rhotic-dictionary"></a>
</h4>
<p>MFA also includes <a href="https://mfa-models.readthedocs.io/en/latest/acoustic/English/English%20MFA%20acoustic%20model%20v2_0_0.html#English%20MFA%20acoustic%20model%20v2_0_0" class="external-link">IPA-encoded models trained on 3687 hours of English speech</a> of a number of varieties, and an <a href="https://mfa-models.readthedocs.io/en/latest/dictionary/English/English%20%28UK%29%20MFA%20dictionary%20v2_0_0.html#English%20(UK)%20MFA%20dictionary%20v2_0_0" class="external-link">IPA-encoded British English pronunciation dictionary</a> which may perform better for our New Zealand English data, as both varieties are non-rhotic (unlike the US English dictionary used for the <em>mfaGAm</em> layer above).</p>
<p>This configuration uses pre-trained English models and pronunciations from an IPA encoded British English dictionary.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># create layer</span>
<span class="va">mfaUKE</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/newLayer.html">newLayer</a></span><span class="op">(</span>
  <span class="va">url</span>, <span class="st">"mfaUKE"</span>, 
  description <span class="op">=</span> <span class="st">"Word alignments from MFA using an IPA dictionary and pretrained models."</span>,
  alignment <span class="op">=</span> <span class="fl">2</span>, parent.id <span class="op">=</span> <span class="st">"turn"</span>, <span class="co"># a phrase layer</span>
  annotator.id <span class="op">=</span> <span class="st">"MFA"</span>, 
  annotator.task.parameters <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span>
    <span class="st">"orthographyLayerId=orthography"</span>,
    <span class="st">"dictionaryName=english_uk_mfa"</span>,
    <span class="st">"modelsName=english_mfa"</span>,
    <span class="st">"wordAlignmentLayerId=mfaUKE"</span>,       <span class="co"># save word alignments to this layer</span>
    <span class="st">"phoneAlignmentLayerId=mfaUKEPhone"</span>, <span class="co"># this will be created by the annotator</span>
    sep<span class="op">=</span><span class="st">"&amp;"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
</div>
</div>
<div class="section level3">
<h3 id="bas-web-service-and-maus-basic">BAS Web Service and MAUS Basic<a class="anchor" aria-label="anchor" href="#bas-web-service-and-maus-basic"></a>
</h3>
<p>MAUSBasic web service; part of the CLARIN-D’s <a href="https://clarin.phonetik.uni-muenchen.de/BASWebServices/interface" class="external-link">BAS Web Services suite</a> provides a <a href="https://clarin.phonetik.uni-muenchen.de/BASWebServices/interface/WebMAUSBasic" class="external-link">web service</a> for the MAUS forced aligner, which supports a number of languages and varieties.</p>
<p>LaBB-CAT integrates with the BAS Web Services using a module called <em>BASAnnotator</em> (which also provides access to the G2P BAS web service):</p>
<details><summary><code>getAnnotatorDescriptor(url, "BASAnnotator")$taskParameterInfo</code></summary><h3>BAS Annotator</h3>

<p> This annotator connects to the BAS web services 
  - <a href="http://hdl.handle.net/11858/00-1779-0000-0028-421B-4" target="BAS" class="external-link">
    http://hdl.handle.net/11858/00-1779-0000-0028-421B-4</a>, 
  hosted by Ludwig Maximilians Universität München -
  for various annotation tasks. </p> 

<p> Current annotation tasks include: </p>
<ul>
<li> Using <a href="https://clarin.phonetik.uni-muenchen.de/BASWebServices/interface/Grapheme2Phoneme" target="BAS" class="external-link">G2P</a> to annotate words with their phonemic transcription, given their orthography.</li>
    <li> Using <a href="https://clarin.phonetik.uni-muenchen.de/BASWebServices/interface/WebMAUSBasic" target="BAS" class="external-link"> WebMAUSBasic</a> to force-align utterances, given their orthographic transcriptions.</li> </ul>
<p> Please note that using these services requires sending transcript, annotation, and
  audio data over the internet to the external provider of these services. </p> 

<p> Configuration parameters are encoded as a URL query string, e.g. <br><samp>orthographyLayerId=orthography&amp;service=MAUSBasic&amp;forceLanguageMAUSBasic=deu-DE&amp;phonemeEncoding=disc&amp;wordAlignmentLayerId=word&amp;phoneAlignmentLayerId=segment&amp;utteranceTagLayerId=bas</samp>
</p>

<p> Parameters are: </p> <dl>
<dt> orthographyLayerId </dt> <dd> Input layer from which words come. </dd>
  <dt> transcriptLanguageLayerId </dt> <dd> Transcript attribute for overall language. </dd>
  <dt> targetLanguagePattern </dt> <dd> Regular expression for the ISO language codes
    of the languages to target, or blank for all. </dd> 
  <dt> service </dt> <dd> Which BAS web service to use - "MAUSBasic" or "G2P" </dd>
  <dt> phonemeEncoding </dt> <dd> Which set of symbols to use for phoneme
    layers. Options are: <ul>
<li>disc</li>
      <li>sampa</li>
      <li>x-sampa</li>
      <li>maus-sampa</li>
      <li>ipa</li>
      <li>arpabet</li> </ul>
</dd>
  <dt> forceLanguageMAUSBasic </dt> <dd> Language to tell the MAUSBasic web service the
    utterances are in, regardless of the language the transcript is in (Optional -
    <tt>service=MAUSBasic</tt> only).</dd>  
  <dt> forceLanguageG2P </dt> <dd> Language to tell the G2P web service the
    utterances are in, regardless of the language the transcript is in (Optional -
    <tt>service=G2P</tt> only).</dd>  
  <dt> pronunciationLayerId </dt> <dd> Output layer to which pronunciations are
    added (<tt>service=G2P</tt> only).</dd>
  <dt> wordStress </dt> <dd> Send any non-empty value of this parameter to include
    lexical stress marks, omit the parameter to omit stress marks
    (<tt>service=G2P</tt> only).  </dd>
  <dt> syllabification </dt> <dd> Send any non-empty value of this parameter to include
    syllabification marks, omit the parameter to syllabification marks
    (<tt>service=G2P</tt> only).  </dd>
  <dt> wordAlignmentLayerId </dt> <dd> Output layer on which word alignments are
    saved. This can be <tt>word</tt> to update main word token alignments, or a
    phrase layer to save alignments separately from main word token alignments. If
    the specified layer doesn't exist, a phrase layer will be created
    (<tt>service=MAUSBasic</tt> only). </dd>
  <dt> phoneAlignmentLayerId </dt> <dd> Output layer on which phone alignments are
    saved. This can be <tt>segment</tt> to update main phone segment alignments, or a
    phrase layer to save alignments separately from main phone segment alignments. If
    the specified layer doesn't exist, a phrase layer will be created
    (<tt>service=MAUSBasic</tt> only). </dd>
  <dt> utteranceTagLayerId </dt> <dd> Optional output layer for a time stamp tagging
    each aligned utterance. If the specified layer doesn't exist, a phrase layer will
    be created (<tt>service=MAUSBasic</tt> only). </dd> </dl></details><hr>
<p>New Zealand English is supported explicitly by MAUSBasic, so layer is set up to using the following configuration:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">maus</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/newLayer.html">newLayer</a></span><span class="op">(</span>
  <span class="va">url</span>, <span class="st">"maus"</span>, 
  description <span class="op">=</span> <span class="st">"Word alignments from MAUSBasic web service provided by the BAS Web Services."</span>,
  alignment <span class="op">=</span> <span class="fl">2</span>, parent.id <span class="op">=</span> <span class="st">"turn"</span>, <span class="co"># a phrase layer</span>
  annotator.id <span class="op">=</span> <span class="st">"BAS"</span>, 
  annotator.task.parameters <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span>
    <span class="st">"service=MAUSBasic"</span>,
    <span class="st">"orthographyLayerId=orthography"</span>,
    <span class="st">"forceLanguageMAUSBasic=eng-NZ"</span>,   <span class="co"># New Zealand English</span>
    <span class="st">"phonemeEncoding=disc"</span>,            <span class="co"># use DISC for phone labels</span>
    <span class="st">"wordAlignmentLayerId=maus"</span>,       <span class="co"># save word alignments to this layer</span>
    <span class="st">"phoneAlignmentLayerId=mausPhone"</span>, <span class="co"># this will be created by the annotator</span>
    sep <span class="op">=</span> <span class="st">"&amp;"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="upload-transcripts-and-recordings">Upload transcripts and recordings<a class="anchor" aria-label="anchor" href="#upload-transcripts-and-recordings"></a>
</h2>
<p>The speech to be force-aligned is in New Zealand English, and has been transcribed in a Praat. This corpus is (very!) small, but enough to illustrate what’s possible.</p>
<p>TextGrid files are uploaded with their corresponsing .wav files. The TextGrids include manually aligned words and segments (phones). The phone labels use the CELEX ‘DISC’ encoding, which utilises one character per phoneme. These will be the ‘gold standard’ alignments for evaluating each forced alignment configuration.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># for each transcript</span>
<span class="kw">for</span> <span class="op">(</span><span class="va">transcriptName</span> <span class="kw">in</span> <span class="va">transcriptFiles</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">transcript</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">dataDir</span>, <span class="va">transcriptName</span><span class="op">)</span>
  
  <span class="co"># locate recording</span>
  <span class="va">noExtension</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/substr.html" class="external-link">substr</a></span><span class="op">(</span><span class="va">transcriptName</span>, <span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/nchar.html" class="external-link">nchar</a></span><span class="op">(</span><span class="va">transcriptName</span><span class="op">)</span> <span class="op">-</span> <span class="fl">9</span><span class="op">)</span>
  <span class="va">wav</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">dataDir</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">noExtension</span>, <span class="st">".wav"</span>, sep<span class="op">=</span><span class="st">""</span><span class="op">)</span><span class="op">)</span>
  <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/files.html" class="external-link">file.exists</a></span><span class="op">(</span><span class="va">wav</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
    <span class="va">wav</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">dataDir</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">noExtension</span>, <span class="st">".WAV"</span>, sep<span class="op">=</span><span class="st">""</span><span class="op">)</span><span class="op">)</span>
  <span class="op">}</span>
  <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/files.html" class="external-link">file.exists</a></span><span class="op">(</span><span class="va">wav</span><span class="op">)</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">wav</span>, <span class="st">"doesn't exist\n"</span><span class="op">)</span><span class="op">)</span>
  <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/files.html" class="external-link">file.exists</a></span><span class="op">(</span><span class="va">transcript</span><span class="op">)</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">transcript</span>, <span class="st">"doesn't exist\n"</span><span class="op">)</span><span class="op">)</span>
  
  <span class="co"># upload the transcript/recording</span>
  <span class="fu"><a href="../../reference/newTranscript.html">newTranscript</a></span><span class="op">(</span><span class="va">url</span>, <span class="va">transcript</span>, <span class="va">wav</span>, no.progress <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>

<span class="op">}</span> <span class="co"># next trancript</span></code></pre></div>
<pre><code><span class="co">## [1] "Token layer not found: null"</span></code></pre>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"Transcripts uploaded: "</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">transcriptFiles</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## Transcripts uploaded:  1</span></code></pre>
<p>At this point the manually aligned transcripts have been uploaded, and all of the forced-alignment configurations have been run.</p>
</div>
<div class="section level2">
<h2 id="compare-automatic-alignments-with-manual-alignments">Compare Automatic Alignments with Manual Alignments<a class="anchor" aria-label="anchor" href="#compare-automatic-alignments-with-manual-alignments"></a>
</h2>
<p>In order to compare the word and phone alignments produced by the forced aligners with the manual alignments, we use LaBB-CAT’s Label Mapper layer manager:</p>
<details><summary><code>getAnnotatorDescriptor(url, "LabelMapper")$info</code></summary><h2> Label Mapper </h2>

<p> This annotator creates a mapping between the labels of pairs of layers, by finding the
  minimum edit path between them. </p> 

<p> For example, this layer manager can be used to tag each phone in a word with its
  likely counterpart in another phonemic transcription: </p>

<table class="table">
<tr>
<td>d</td>
<td>ɪ</td>
<td>f</td>
<td>ə</td>
<td>ɹ</td>
<td>n̩</td>
<td>t</td>
</tr>
<tr>
<td>↓</td>
<td>↓</td>
<td>↓</td>
<td></td>
<td>↓</td>
<td>↓</td>
<td>↓</td>
</tr>
<tr>
<td>d</td>
<td>ɪ</td>
<td>f</td>
<td></td>
<td>ɹ</td>
<td>ən</td>
<td>t</td>
</tr>
</table>
<p> … or phonemic encoding: </p>

<table class="table">
<tr>
<td>d</td>
<td>ɪ</td>
<td>f</td>
<td>ə</td>
<td>ɹ</td>
<td>n̩</td>
<td>t</td>
</tr>
<tr>
<td>↓</td>
<td>↓</td>
<td>↓</td>
<td>↓</td>
<td>↓</td>
<td>↓</td>
<td>↓</td>
</tr>
<tr>
<td>D</td>
<td>IH1</td>
<td>F</td>
<td>ER0</td>
<td>R</td>
<td>AH0 N</td>
<td>T</td>
</tr>
</table>
<p> One possible use is to map non-rhotic phones to their equivalent rhotic
  transcription: </p>

<table class="table">
<tr>
<td>f</td>
<td>αɪ</td>
<td>ə</td>
<td>f</td>
<td>αɪ</td>
<td>t</td>
<td>ə</td>
</tr>
<tr>
<td>↓</td>
<td>↓</td>
<td>↓</td>
<td>↓</td>
<td>↓</td>
<td>↓</td>
<td>↓</td>
</tr>
<tr>
<td>f</td>
<td>αɪ</td>
<td>əɹ</td>
<td>f</td>
<td>αɪ</td>
<td>t</td>
<td>əɹ</td>
</tr>
</table>
<h3> Forced Alignment Comparison </h3>

<p> The Label Mapper can also be used to compare alternative word/phone alignments -
  e.g. you may have manual word/phone alignment that you want to compare with
  word/phone alignmentd automatically generated by HTK, in order to measure the
  accuracy of the automatic alignments. </p>

<p> In this case, you specify two mappings, a main mapping between a pair of word
  alignment layers, and a sub-mapping between a paird of phone alignment layers. </p>

<table class="table">
<tr class="source">
<th>Word Source</th>
    <td><i>CMUDictWord</i></td>
    <td colspan="8" class="word">DIFFERENT</td>
    <td colspan="7" class="word">FIREFIGHTER</td>
  </tr>
<tr>
<th> </th>
    <td> </td>
    <td colspan="8">↓</td>
<td colspan="7">↓</td>
  </tr>
<tr class="target">
<th>Word Target</th>
    <td><i>orthography</i></td>
    <td colspan="8" class="word">different</td>
    <td colspan="7" class="word">firefighter</td>
  </tr>
<tr class="source">
<th>Phone Source</th>
    <td><i>P2FAPhone</i></td>
    <td>D</td>
<td>IH1</td>
<td>F</td>
<td>ER0</td>
<td>R</td>
<td>AH0</td>
<td>N</td>
<td>T</td>
    <td>F</td>
<td>AY1</td>
<td>R</td>
<td>F</td>
<td>AY2</td>
<td>T</td>
<td>ER0</td>
  </tr>
<tr>
<th> </th>
    <td> </td>
    <td>↓</td>
<td>↓</td>
<td>↓</td>
<td></td>
<td>↓</td>
<td>↓</td>
<td>↓</td>
<td>↓</td>
    <td>↓</td>
<td>↓</td>
<td>↓</td>
<td>↓</td>
<td>↓</td>
<td>↓</td>
<td>↓</td>
  </tr>
<tr class="target">
<th>Phone Target</th>
    <td><i>segments</i></td>
    <td>d</td>
<td>I</td>
<td>f</td>
<td></td>
<td>r</td>
<td>@</td>
<td>n</td>
<td>t</td>
    <td>f</td>
<td>2</td>
<td>@</td>
<td>f</td>
<td>2</td>
<td>t</td>
<td>@</td>
  </tr>
</table>
<p> These mappings are tracked in detail, to facilitate comparison of alignment
  and labelling. Mapping information can be accessed via the 'extensions' page of
  this annotator. </p>
</details><hr>
<p>The details of the Label Mapper configuration are:</p>
<details><summary><code>getAnnotatorDescriptor(url, "LabelMapper")$taskParameterInfo</code></summary><h3>Label Mapper</h3>

<p> This annotator creates a mapping between the labels of two layers, a <q>source</q>
  layer and a <q>target</q> layer, by finding the minimum edit path between them. </p>

<h2> Phone Sub-mapping </h2>

<p> A phone Sub-mapping may be configured if you are mapping word tokens on one layer
  to word tokens on another layer. In this case, map phone tokens on a source layer
  to phone tokens on a target layer - i.e. you can compare two sets of word/phone
  annotations. </p>

<p> The words on the <b>sourceLayerId</b> are assumed to be divided into phones
  that are on the <b>subSourceLayerId</b>, and
  the words on the <b>targetLayerId</b> are assumed to be divided into phones that
  are on the <b>subTargetLayerId</b>. </p>

<p> These mappings are tracked in detail, to facilitate comparison of alignment
  and labelling. Mapping information can be accessed via this annotator's
  extensions. </p>

<h2>Encoding</h2>

<p> Configuration parameters are encoded as a URL query string, e.g. <br><samp>sourceLayerId=orthography&amp;splitLabels=&amp;mappingLayerId=&amp;comparator=CharacterToCharacter&amp;targetLayerId=mfaPretrainedARPAbet&amp;subSourceLayerId=segment&amp;subComparator=DISCToArpabet&amp;subTargetLayerId=mfaPretrainedARPAbetPhone</samp> </p>

<h2>Parameters</h2>    
<dl>
<dt> sourceLayerId </dt> <dd> Input layer from which the resulting annotations'
    labels come from come. </dd>
  <dt> targetLayerId </dt> <dd> This layer defines which tokens will be tagged. Each
    annotation on this layer will have one tag added, with one or more labels from
    the <em>sourceLayerId</em>, unless no correspondence can be found, in which case
    the token is not tagged. </dd> 
  <dt> mappingLayerId </dt> <dd> Output layer mapping the Source layer to the Target
    layer. If no <i>Phone Sub-mapping</i> is specified (see below), any Source Layer
    labels that cannot be directly mapped to a Target token will be appended to a nearby
    Mapping Layer label; i.e. appended to the last one where possible.</dd> 
  <dt> comparator </dt> <dd> How the Source layer and the Target layer labels relate
    to each other. Possible values are: <ul>
<li>
<q>CharacterToCharacter</q> - Orthography → Orthography</li>
      <li>
<q>OrthographyToDISC</q> - Orthography → DISC</li>
      <li>
<q>OrthographyToArpabet</q> - Orthography → ARPAbet</li>
      <li>
<q>DISCToDISC</q> - DISC → DISC</li>
      <li>
<q>DISCToArpabet</q> - DISC → ARPAbet</li>
      <li>
<q>ArpabetToDISC</q> - ARPAbet → DISC</li>
      <li>
<q>IPAToIPA</q> - IPA → IPA</li>
      <li>
<q>DISCToIPA</q> - DISC → IPA</li>
      <li>
<q>IPAToDISC</q> - IPA → DISC</li>
  </ul>
</dd>
  <dt> splitLabels </dt> <dd>
    Possible values are: <ul>
<li>
<q>char</q> - Use the first annotation in the scope, split its label into
        characters, and map each to labels on the target layer (e.g. DISC word
        transcriptions to phones). </li> 
      <li>
<q>space</q> - Use the first annotation in the scope, split its label on
        spaces, and map each to labels on the target layer (e.g. ARPAbet word
        transcriptions to phones). </li>
      <li>
<q></q> (nothing) - Use all annotations in the scope, and do not split their
        labels (e.g. phone alignments to other phone alignments). </li>
    </ul>
</dd>
<dt> subSourceLayerId </dt> <dd> (Optional) Source Layer and Target Layer above identify
    words, which can be subdivided into phones on this layer and the subTargetLayerId
    below.
    <br> The Sub-mapping option should only be configured if: <ul>
<li> The <b>splitLabels</b> parameter is omitted, and</li>
      <li> The <b>comparator</b> is set to <q>CharacterToCharacter</q> </li>
    </ul>
    i.e. you are mapping word tokens on one layer to word tokens on another layer.
    </dd>
  <dt> subTargetLayerId </dt> <dd> Which tokens will be tagged for the sub-mapping. </dd>
  <dt> subComparator </dt> <dd> How the Source layer and the Target layer labels relate
    to each other. Possible values are: <ul>
<li>
<q>CharacterToCharacter</q> - Orthography → Orthography</li>
      <li>
<q>OrthographyToDISC</q> - Orthography → DISC</li>
      <li>
<q>OrthographyToArpabet</q> - Orthography → ARPAbet</li>
      <li>
<q>DISCToDISC</q> - DISC → DISC</li>
      <li>
<q>DISCToArpabet</q> - DISC → ARPAbet</li>
      <li>
<q>ArpabetToDISC</q> - ARPAbet → DISC</li>
      <li>
<q>IPAToIPA</q> - IPA → IPA</li>
      <li>
<q>DISCToIPA</q> - DISC → IPA</li>
      <li>
<q>IPAToDISC</q> - IPA → DISC</li>
  </ul>
</dd>
  
</dl></details><hr>
<p>A comparison is set up for each of the forced-alignment configurations above, i.e each automatic word alignment is matched to a corresponding manual word alignment, and within each word, each automatic phone alignment is matched to a corresponding manual phone alignment. Once this is done, it’s possible to measure the degree to which the automatic alignments overlap with the manual ones.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># compare p2fa alignments with manual ones</span>
<span class="va">p2faComp</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/newLayer.html">newLayer</a></span><span class="op">(</span>
  <span class="va">url</span>, <span class="st">"p2faComp"</span>, 
  description <span class="op">=</span> <span class="st">"Compare P2FA alignments with Manual alignments."</span>,
  alignment <span class="op">=</span> <span class="fl">2</span>, parent.id <span class="op">=</span> <span class="st">"turn"</span>, <span class="co"># a phrase layer</span>
  annotator.id <span class="op">=</span> <span class="st">"labelmapper"</span>, 
  annotator.task.parameters <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span>
    <span class="st">"sourceLayerId=orthography"</span>,
    <span class="st">"targetLayerId=p2fa"</span>,
    <span class="st">"splitLabels="</span>,                    <span class="co"># no splitting; target to source annotations map 1:1</span>
    <span class="st">"comparator=CharacterToCharacter"</span>, <span class="co"># word tokens use plain orthography</span>
    <span class="st">"subSourceLayerId=segment"</span>,
    <span class="st">"subTargetLayerId=p2faPhone"</span>, 
    <span class="st">"subComparator=DISCToArpabet"</span>,     <span class="co"># phone tokens in p2faPhone use ARPAbet encoding</span>
    sep<span class="op">=</span><span class="st">"&amp;"</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="../../reference/generateLayer.html">generateLayer</a></span><span class="op">(</span><span class="va">url</span>, <span class="st">"p2faComp"</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## [1] "Invalid sub-mapping token layer: p2faPhone"</span>
<span class="co">## [1] "Invalid sub-mapping token layer: p2faPhone"</span>
<span class="co">## [1] "Invalid sub-mapping token layer: p2faPhone"</span>
<span class="co">## [1] "Invalid sub-mapping token layer: p2faPhone"</span>
<span class="co">## [1] "Invalid sub-mapping token layer: p2faPhone"</span>
<span class="co">## [1] "Invalid sub-mapping token layer: p2faPhone"</span>
<span class="co">## [1] "Invalid sub-mapping token layer: p2faPhone"</span>
<span class="co">## [1] "Invalid sub-mapping token layer: p2faPhone"</span>
<span class="co">## [1] "Invalid sub-mapping token layer: p2faPhone"</span>
<span class="co">## [1] "Invalid sub-mapping token layer: p2faPhone"</span>
<span class="co">## [1] "Invalid sub-mapping token layer: p2faPhone"</span>
<span class="co">## [1] "Invalid sub-mapping token layer: p2faPhone"</span>
<span class="co">## [1] "Invalid sub-mapping token layer: p2faPhone"</span>
<span class="co">## [1] "Invalid sub-mapping token layer: p2faPhone"</span>
<span class="co">## [1] "Invalid sub-mapping token layer: p2faPhone"</span>
<span class="co">## [1] "Invalid sub-mapping token layer: p2faPhone"</span>
<span class="co">## [1] "Invalid sub-mapping token layer: p2faPhone"</span></code></pre>
<pre><code><span class="co">## [1] "Layer complete."</span></code></pre>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># compare MFA ARPAbet alignments with manual ones</span>
<span class="va">mfaGAmComp</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/newLayer.html">newLayer</a></span><span class="op">(</span>
  <span class="va">url</span>, <span class="st">"mfaGAmComp"</span>, 
  description <span class="op">=</span> <span class="st">"Compare MFA ARPAbet pretrained-model alignments with Manual alignments."</span>,
  alignment <span class="op">=</span> <span class="fl">2</span>, parent.id <span class="op">=</span> <span class="st">"turn"</span>, <span class="co"># a phrase layer</span>
  annotator.id <span class="op">=</span> <span class="st">"labelmapper"</span>, 
  annotator.task.parameters <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span>
    <span class="st">"sourceLayerId=orthography"</span>,
    <span class="st">"targetLayerId=mfaGAm"</span>,
    <span class="st">"splitLabels="</span>,                    <span class="co"># no splitting; target to source annotations map 1:1</span>
    <span class="st">"comparator=CharacterToCharacter"</span>, <span class="co"># word tokens use plain orthography</span>
    <span class="st">"subSourceLayerId=segment"</span>,
    <span class="st">"subTargetLayerId=mfaGAmPhone"</span>, 
    <span class="st">"subComparator=DISCToArpabet"</span>,     <span class="co"># phone tokens in mfaGAmPhone use ARPAbet encoding</span>
    sep<span class="op">=</span><span class="st">"&amp;"</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="../../reference/generateLayer.html">generateLayer</a></span><span class="op">(</span><span class="va">url</span>, <span class="st">"mfaGAmComp"</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## [1] "Invalid sub-mapping token layer: mfaGAmPhone"</span>
<span class="co">## [1] "Invalid sub-mapping token layer: mfaGAmPhone"</span>
<span class="co">## [1] "Invalid sub-mapping token layer: mfaGAmPhone"</span>
<span class="co">## [1] "Invalid sub-mapping token layer: mfaGAmPhone"</span>
<span class="co">## [1] "Invalid sub-mapping token layer: mfaGAmPhone"</span>
<span class="co">## [1] "Invalid sub-mapping token layer: mfaGAmPhone"</span>
<span class="co">## [1] "Invalid sub-mapping token layer: mfaGAmPhone"</span>
<span class="co">## [1] "Invalid sub-mapping token layer: mfaGAmPhone"</span>
<span class="co">## [1] "Invalid sub-mapping token layer: mfaGAmPhone"</span>
<span class="co">## [1] "Invalid sub-mapping token layer: mfaGAmPhone"</span>
<span class="co">## [1] "Invalid sub-mapping token layer: mfaGAmPhone"</span>
<span class="co">## [1] "Invalid sub-mapping token layer: mfaGAmPhone"</span>
<span class="co">## [1] "Invalid sub-mapping token layer: mfaGAmPhone"</span>
<span class="co">## [1] "Invalid sub-mapping token layer: mfaGAmPhone"</span></code></pre>
<pre><code><span class="co">## [1] "Layer complete."</span></code></pre>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># compare MFA non-rhotic IPA alignments with manual ones</span>
<span class="va">mfaUKEComp</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/newLayer.html">newLayer</a></span><span class="op">(</span>
  <span class="va">url</span>, <span class="st">"mfaUKEComp"</span>, 
  description <span class="op">=</span> <span class="st">"Compare MFA IPA pretrained-model alignments with Manual alignments."</span>,
  alignment <span class="op">=</span> <span class="fl">2</span>, parent.id <span class="op">=</span> <span class="st">"turn"</span>, <span class="co"># a phrase layer</span>
  annotator.id <span class="op">=</span> <span class="st">"labelmapper"</span>, 
  annotator.task.parameters <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span>
    <span class="st">"sourceLayerId=orthography"</span>,
    <span class="st">"targetLayerId=mfaUKE"</span>,
    <span class="st">"splitLabels="</span>,                    <span class="co"># no splitting; target to source annotations map 1:1</span>
    <span class="st">"comparator=CharacterToCharacter"</span>, <span class="co"># word tokens use plain orthography</span>
    <span class="st">"subSourceLayerId=segment"</span>,
    <span class="st">"subTargetLayerId=mfaUKEPhone"</span>, 
    <span class="st">"subComparator=DISCToIPA"</span>,         <span class="co"># phone tokens in mfaUKEPhone use IPA encoding</span>
    sep<span class="op">=</span><span class="st">"&amp;"</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="../../reference/generateLayer.html">generateLayer</a></span><span class="op">(</span><span class="va">url</span>, <span class="st">"mfaUKEComp"</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## [1] "Invalid sub-mapping token layer: mfaUKEPhone"</span>
<span class="co">## [1] "Invalid sub-mapping token layer: mfaUKEPhone"</span>
<span class="co">## [1] "Invalid sub-mapping token layer: mfaUKEPhone"</span>
<span class="co">## [1] "Invalid sub-mapping token layer: mfaUKEPhone"</span>
<span class="co">## [1] "Invalid sub-mapping token layer: mfaUKEPhone"</span>
<span class="co">## [1] "Invalid sub-mapping token layer: mfaUKEPhone"</span>
<span class="co">## [1] "Invalid sub-mapping token layer: mfaUKEPhone"</span>
<span class="co">## [1] "Invalid sub-mapping token layer: mfaUKEPhone"</span>
<span class="co">## [1] "Invalid sub-mapping token layer: mfaUKEPhone"</span>
<span class="co">## [1] "Invalid sub-mapping token layer: mfaUKEPhone"</span>
<span class="co">## [1] "Invalid sub-mapping token layer: mfaUKEPhone"</span>
<span class="co">## [1] "Invalid sub-mapping token layer: mfaUKEPhone"</span>
<span class="co">## [1] "Invalid sub-mapping token layer: mfaUKEPhone"</span></code></pre>
<pre><code><span class="co">## [1] "Layer complete."</span></code></pre>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># compare MAUSBasic alignments with manual ones</span>
<span class="va">mausComp</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/newLayer.html">newLayer</a></span><span class="op">(</span>
  <span class="va">url</span>, <span class="st">"mausComp"</span>, 
  description <span class="op">=</span> <span class="st">"Compare MAUS Basic New Zealand English alignments with Manual alignments."</span>,
  alignment <span class="op">=</span> <span class="fl">2</span>, parent.id <span class="op">=</span> <span class="st">"turn"</span>, <span class="co"># a phrase layer</span>
  annotator.id <span class="op">=</span> <span class="st">"labelmapper"</span>, 
  annotator.task.parameters <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span>
    <span class="st">"sourceLayerId=orthography"</span>,
    <span class="st">"targetLayerId=maus"</span>,
    <span class="st">"splitLabels="</span>,                    <span class="co"># no splitting; target to source annotations map 1:1</span>
    <span class="st">"comparator=CharacterToCharacter"</span>, <span class="co"># word tokens use plain orthography</span>
    <span class="st">"subSourceLayerId=segment"</span>,
    <span class="st">"subTargetLayerId=mausPhone"</span>, 
    <span class="st">"subComparator=DISCToDISC"</span>,        <span class="co"># phone tokens in mausPhone use DISC encoding</span>
    sep<span class="op">=</span><span class="st">"&amp;"</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="../../reference/generateLayer.html">generateLayer</a></span><span class="op">(</span><span class="va">url</span>, <span class="st">"mausComp"</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## [1] "Invalid sub-mapping token layer: mausPhone"</span>
<span class="co">## [1] "Invalid sub-mapping token layer: mausPhone"</span>
<span class="co">## [1] "Invalid sub-mapping token layer: mausPhone"</span>
<span class="co">## [1] "Invalid sub-mapping token layer: mausPhone"</span>
<span class="co">## [1] "Invalid sub-mapping token layer: mausPhone"</span>
<span class="co">## [1] "Invalid sub-mapping token layer: mausPhone"</span>
<span class="co">## [1] "Invalid sub-mapping token layer: mausPhone"</span>
<span class="co">## [1] "Invalid sub-mapping token layer: mausPhone"</span>
<span class="co">## [1] "Invalid sub-mapping token layer: mausPhone"</span>
<span class="co">## [1] "Invalid sub-mapping token layer: mausPhone"</span>
<span class="co">## [1] "Invalid sub-mapping token layer: mausPhone"</span>
<span class="co">## [1] "Invalid sub-mapping token layer: mausPhone"</span>
<span class="co">## [1] "Invalid sub-mapping token layer: mausPhone"</span></code></pre>
<pre><code><span class="co">## [1] "Layer complete."</span></code></pre>
</div>
<div class="section level2">
<h2 id="edit-paths-and-alignment-comparisons">Edit Paths and Alignment Comparisons<a class="anchor" aria-label="anchor" href="#edit-paths-and-alignment-comparisons"></a>
</h2>
<p>The LabelMapper has an extended API for exporting information about the edit-paths computed, and the resulting alignment comparisons.</p>
<details><summary><code>getAnnotatorDescriptor(url, "LabelMapper")$extApiInfo</code></summary><h3>Label Mapper</h3>

<p> This annotator creates a mapping between the labels of a pair of layers, by finding the
  minimum edit path between them. If any <i>sub-mappings</i> have been configured - where two
  pairs of layers are mapped, two word layers and two corresponding phone layers -
  these mappings are tracked in detail so that alignments and label assignments can be
  compared. </p>

<p> This API provides access to tracked sub-mapping information, including raw
  mapping data and summary information including mean <i>Overlap Rate</i>. </p>

<details><summary><i>Overlap Rate</i> is a value between 0 and 1. A value of 0 means that the
    two intervals do not overlap at all, with 1 meaning they completely
    overlap. </summary><p><a href="http://dx.doi.org/10.1007/978-3-540-30228-5_4" target="PauloOliveira2004" class="external-link"> Paulo and Oliveira (2004) </a>
    devised Overlap Rate (OvR) to compare alignments, which measures how
    much two intervals overlap, independent of their absolute durations. OvR is
    calculated as follows: </p>
  
  <style type="text/css">
    .formula {
        display: inline;
        vertical-align: middle;
    }
    .division {
        display: inline-block;
        vertical-align: middle;
    }
    .numerator {
        border-bottom: 1px solid black;
    }
    .numerator, .denominator {
        text-align: center;
        display: block;
    }
    .for-copy-paste { /* Invisible in a browser, but if the formula is copied/pasted, it's included */
        opacity: 0;
    }
  </style>
<div class="formula">
    OνR =
    <span class="division">
      <span class="numerator"> CommonDur <span class="for-copy-paste">/</span> </span>
      <span class="denominator"> DurMax </span>
    </span>
    = 
    <span class="division">
      <span class="numerator"> CommonDur <span class="for-copy-paste">/</span> </span>
      <span class="denominator"><span class="for-copy-paste">(</span>DurRef + DurAuto - CommonDur<span class="for-copy-paste">)</span></span>
    </span>
  </div>
  
  <p> The result is a value between 0 and 1. A value of 0 means that the two intervals
    do not overlap at all, with 1 meaning they completely overlap (i.e., the
    alignments exactly agree). Overlap Rate has several advantages over comparing
    start/end offsets directly: </p>
  <ol>
<li> It provides a single result, with no need to specify different thresholds for
      offset accuracy. </li>
    <li> It gives a measure of how time-spans (rather than time-points) align, and
      these time-spans correspond directly to what is usually the primary unit of
      interest: phones. </li>
    <li> It ensures that a small absolute discrepancy in alignment is more serious for
      short intervals than for longer ones. </li>
  </ol></details><p> The extension API can be used to list and download tracked mappings, by using the
  following endpoints, accessed with a GET http request: </p>
<dl>
<dt><tt>listMappings</tt></dt> <dd>Lists tracked mappings. The response is a JSON-encoded list of
    strings formatted sourceLayerId→targetLayerId, representing tracked mappings that
    can be accessed via other endpoints.</dd>
  <dt><tt>summarizeMapping?<var>id</var></tt></dt> <dd>Provides summary information about the
    given mapping. The query string should be a mapping ID returned
    by <i>listMappings</i>. The response is a JSON-encoded object with summary
    information about the given mapping, e.g.
    <ul>
<li>utteranceCount - number of utterances with a mapping</li>
      <li>stepCount - total number of edit steps</li>
      <li>meanOverlapRate - mean overlap rate across all edit steps</li>
      <li>sourceCount - number of source annotations mapped</li>
      <li>targetCount - number of target annotations mapped</li>
</ul>
</dd>
  <dt><tt>mappingToCsv?<var>id</var></tt></dt> <dd>Provides access to the mapping between the given two
    layers, as a CSV stream. The query string should be a mapping ID returned
    by <i>listMappings</i>. The response is a CSV file containing all edit steps
    mapping all source annotations to target annotations, with the following fields:
    <ul>
<li>
<i>transcript</i> - Transcript ID</li>
      <li>
<i>scope</i> - Parent utterance/word ID </li>
      <li>
<i>URL</i> - URL to the utterance </li>
      <li>
<i>step</i> - The edit step index in the sequence </li>
      <li>
<i>sourceLayer</i> - Layer of the source annotations </li>
      <li>
<i>sourceParentId</i> - ID of the parent of source annotation, if this is a sub-mapping </li>
      <li>
<i>sourceParentLabel</i> - Label of the parent of source annotation, if this is a sub-mapping </li>
      <li>
<i>sourceId</i> - ID of the source annotation </li>
      <li>
<i>sourceLabel</i> - Label of the source annotation </li>
      <li>
<i>sourceStart</i> - Start offset of the source annotation </li>
      <li>
<i>sourceEnd</i> - End offset of the source annotation </li>
      <li>
<i>targetLayer</i> - Layer of the target annotations </li>
      <li>
<i>targetParentId</i> - ID of the parent of target annotation, if this is a sub-mapping </li>
      <li>
<i>targetParentLabel</i> - Label of the parent of target annotation, if this is a sub-mapping </li>
      <li>
<i>targetId</i> - ID of the target annotation </li>
      <li>
<i>targetLabel</i> - Label of the target annotation </li>
      <li>
<i>targetStart</i> - Start offset of the target annotation </li>
      <li>
<i>targetEnd</i> - End offset of the target annotation </li>
      <li>
<i>operation</i> - The edit operation:
        <tt>+</tt> for insert, <tt>-</tt> for delete, <tt>!</tt> for change, <tt>=</tt> for no change </li>
      <li>
<i>distance</i> - Distance (cost) for this edit step </li>
      <li>
<i>hierarchy</i> - This mappings position in the sub-mapping hierarchy:
        <tt>parent</tt>, <tt>child</tt>, or <tt>none</tt> </li>
      <li>
<i>overlapRate</i> - As per Paulo and Oliveira (2004):
        0 means no overlap at all, 1 means they complete overlap </li> </ul>
</dd>
  <dt><tt>deleteMapping?<var>id</var></tt></dt> <dd>Deletes all data associated with the given
    mapping. The query string should be a mapping ID returned by <i>listMappings</i>.</dd>
</dl></details><hr>
<p>The mean overlap rates for the forced alignment configurations can be directly compared, by extracting the mapping summaries and comparing them:</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">p2faPhone</span> <span class="op">&lt;-</span> <span class="fu">jsonlite</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/jsonlite/man/fromJSON.html" class="external-link">fromJSON</a></span><span class="op">(</span>
  <span class="fu"><a href="../../reference/annotatorExt.html">annotatorExt</a></span><span class="op">(</span><span class="va">url</span>, <span class="st">"LabelMapper"</span>, <span class="st">"summarizeMapping"</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"segment"</span>,<span class="st">"p2faPhone"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="va">mfaGAmPhone</span> <span class="op">&lt;-</span> <span class="fu">jsonlite</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/jsonlite/man/fromJSON.html" class="external-link">fromJSON</a></span><span class="op">(</span>
  <span class="fu"><a href="../../reference/annotatorExt.html">annotatorExt</a></span><span class="op">(</span><span class="va">url</span>, <span class="st">"LabelMapper"</span>, <span class="st">"summarizeMapping"</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"segment"</span>,<span class="st">"mfaGAmPhone"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="va">mfaUKEPhone</span> <span class="op">&lt;-</span> <span class="fu">jsonlite</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/jsonlite/man/fromJSON.html" class="external-link">fromJSON</a></span><span class="op">(</span>
  <span class="fu"><a href="../../reference/annotatorExt.html">annotatorExt</a></span><span class="op">(</span><span class="va">url</span>, <span class="st">"LabelMapper"</span>, <span class="st">"summarizeMapping"</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"segment"</span>,<span class="st">"mfaUKEPhone"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="va">mausPhone</span> <span class="op">&lt;-</span> <span class="fu">jsonlite</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/jsonlite/man/fromJSON.html" class="external-link">fromJSON</a></span><span class="op">(</span>
  <span class="fu"><a href="../../reference/annotatorExt.html">annotatorExt</a></span><span class="op">(</span><span class="va">url</span>, <span class="st">"LabelMapper"</span>, <span class="st">"summarizeMapping"</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"segment"</span>,<span class="st">"mausPhone"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>

<span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">p2faPhone</span>, <span class="va">mfaGAmPhone</span>, <span class="va">mfaUKEPhone</span>, <span class="va">mausPhone</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left"></th>
<th align="left">meanOverlapRate</th>
<th align="left">sourceCount</th>
<th align="left">stepCount</th>
<th align="left">targetCount</th>
<th align="left">utteranceCount</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">p2faPhone</td>
<td align="left">0.572620566232039</td>
<td align="left">182</td>
<td align="left">187</td>
<td align="left">186</td>
<td align="left">3</td>
</tr>
<tr class="even">
<td align="left">mfaGAmPhone</td>
<td align="left">0.629468149271323</td>
<td align="left">182</td>
<td align="left">187</td>
<td align="left">185</td>
<td align="left">3</td>
</tr>
<tr class="odd">
<td align="left">mfaUKEPhone</td>
<td align="left">0.650021420932983</td>
<td align="left">182</td>
<td align="left">194</td>
<td align="left">183</td>
<td align="left">3</td>
</tr>
<tr class="even">
<td align="left">mausPhone</td>
<td align="left">0.625540272980146</td>
<td align="left">182</td>
<td align="left">183</td>
<td align="left">178</td>
<td align="left">3</td>
</tr>
</tbody>
</table>
<p>The LabelMapper module can also provide finely-grained details of the mappings - i.e. exactly which manual phones mapped to which automatic phones.</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># get edit paths for manual-to-P2FA comparison</span>
<span class="va">p2faPhoneEditPaths</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.csv</a></span><span class="op">(</span>
  text <span class="op">=</span> <span class="fu"><a href="../../reference/annotatorExt.html">annotatorExt</a></span><span class="op">(</span><span class="va">url</span>, <span class="st">"LabelMapper"</span>, <span class="st">"mappingToCsv"</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"segment"</span>,<span class="st">"p2faPhone"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="co"># show a sample of the paths to give an idea</span>
<span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span>
  <span class="va">p2faPhoneEditPaths</span><span class="op">[</span>
    <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"sourceParentLabel"</span>, <span class="st">"sourceLabel"</span>, <span class="st">"sourceStart"</span>,<span class="st">"sourceEnd"</span>, 
      <span class="st">"targetLabel"</span>, <span class="st">"targetStart"</span>,<span class="st">"targetEnd"</span>, <span class="st">"overlapRate"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span>,
  <span class="co"># tweak some column names for display purposes</span>
  col.names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Word"</span>,<span class="st">"sourceLabel"</span>, <span class="st">"sourceStart"</span>,<span class="st">"sourceEnd"</span>, 
      <span class="st">"targetLabel"</span>, <span class="st">"targetStart"</span>,<span class="st">"targetEnd"</span>, <span class="st">"OvR"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left">Word</th>
<th align="left">sourceLabel</th>
<th align="right">sourceStart</th>
<th align="right">sourceEnd</th>
<th align="left">targetLabel</th>
<th align="right">targetStart</th>
<th align="right">targetEnd</th>
<th align="right">OvR</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">yes</td>
<td align="left">j</td>
<td align="right">6.384000</td>
<td align="right">6.622325</td>
<td align="left">Y</td>
<td align="right">6.414</td>
<td align="right">6.644</td>
<td align="right">0.8012497</td>
</tr>
<tr class="even">
<td align="left">yes</td>
<td align="left">E</td>
<td align="right">6.622325</td>
<td align="right">6.754000</td>
<td align="left">EH1</td>
<td align="right">6.644</td>
<td align="right">6.754</td>
<td align="right">0.8353896</td>
</tr>
<tr class="odd">
<td align="left">yes</td>
<td align="left">s</td>
<td align="right">6.754000</td>
<td align="right">6.854000</td>
<td align="left">S</td>
<td align="right">6.754</td>
<td align="right">6.864</td>
<td align="right">0.9090909</td>
</tr>
<tr class="even">
<td align="left">on</td>
<td align="left">Q</td>
<td align="right">6.854000</td>
<td align="right">6.944000</td>
<td align="left">AA1</td>
<td align="right">6.864</td>
<td align="right">6.954</td>
<td align="right">0.8000000</td>
</tr>
<tr class="odd">
<td align="left">on</td>
<td align="left">n</td>
<td align="right">6.944000</td>
<td align="right">7.054000</td>
<td align="left">N</td>
<td align="right">6.954</td>
<td align="right">7.134</td>
<td align="right">0.5263158</td>
</tr>
<tr class="even">
<td align="left">the</td>
<td align="left">D</td>
<td align="right">8.311241</td>
<td align="right">8.350198</td>
<td align="left">DH</td>
<td align="right">7.564</td>
<td align="right">7.694</td>
<td align="right">0.0000000</td>
</tr>
</tbody>
</table>
<p>This allows closer analysis of the forced-alignments, beyond the overlap rate summary.</p>
<p>For example, it allows us to identify which phones are being produced the the forced aligner which have no corresponding phone in the manual alignments; forced aligners that are using a rhotic dictionary are expected to produce many spurious /r/ segments that are not really present in the non-rhotic speech in the corpus:</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># identify all edit steps where a phone is added - i.e. the source phone label is empty</span>
<span class="va">spuriousSegments</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">p2faPhoneEditPaths</span>, <span class="va">sourceLabel</span> <span class="op">==</span> <span class="st">""</span><span class="op">)</span>
<span class="co"># count these spurious segments grouping by their label to see which is most common</span>
<span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span>
  <span class="fu"><a href="https://rdrr.io/r/stats/aggregate.html" class="external-link">aggregate</a></span><span class="op">(</span><span class="va">spuriousSegments</span><span class="op">$</span><span class="va">targetLabel</span>, 
            by<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">spuriousSegments</span><span class="op">$</span><span class="va">targetLabel</span><span class="op">)</span>, 
            FUN<span class="op">=</span><span class="va">length</span><span class="op">)</span>,
  col.names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Spurious Segment"</span>, <span class="st">"Count"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left">Spurious Segment</th>
<th align="right">Count</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">AH0</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">D</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">R</td>
<td align="right">2</td>
</tr>
<tr class="even">
<td align="left">V</td>
<td align="right">1</td>
</tr>
</tbody>
</table>
<p>With this detailed mapping information, it’s possible to:</p>
<ul>
<li>identify which segments are added or removed</li>
<li>analyse which types of segments are aligned more accurately, e.g. vowels vs. consonants, etc.</li>
<li>apply other alignment accuracy measurements other than Overlap Rate</li>
</ul>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><style type="text/css">
  footer img {
      vertical-align: middle;
      height: 40px;
      display: inline-block;
  }
</style>
<small><a rel="license" href="http://creativecommons.org/licenses/by-sa/2.0/" class="external-link"><img alt="CC-BY-SA Creative Commons Licence " src="https://nzilbb.github.io/labbcat-R/cc-by-sa.svg" title="This work is licensed under a Creative Commons Attribution-ShareAlike 2.0 Generic License"></a><a rel="author" href="https://www.canterbury.ac.nz/nzilbb/" class="external-link"><img src="https://nzilbb.github.io/labbcat-R/nzilbb.svg" alt="Te Kāhui Roro Reo | The New Zealand Institute of Language, Brain and Behaviour" title="🄯 2021 NZILBB"></a></small>

      </footer>
</div>

  


  

  </body>
</html>
